%---------------------------------------------------------------------------------------------------
% preanble.tex                                                                                     |
% Written by junk-e <junk05301996@gmail.com>                                                       |
%---------------------------------------------------------------------------------------------------
%---------------------------------------------------------------------------------------------------
% Packages                                                                                         |
%---------------------------------------------------------------------------------------------------

\usepackage[match,no-math]{luatexja-fontspec}
\usepackage[deluxe,noto-otf]{luatexja-preset}
\usepackage[]{amsmath,amssymb}
\usepackage[]{fancyhdr}
\usepackage[]{float}
\usepackage[]{gnuplot-lua-tikz}
\usepackage[]{graphicx}
\usepackage[]{listings}
\usepackage[per-mode=symbol]{siunitx}
\usepackage[]{tabularx}
\usepackage[]{tikz}
\usepackage[]{url}

\makeatletter
  \let\MYcaption\@makecaption
\makeatother
\usepackage[subrefformat=parens]{subcaption}
\captionsetup{compatibility=false}
\makeatletter
  \let\@makecaption\MYcaption
\makeatother

%---------------------------------------------------------------------------------------------------
% Margin                                                                                           |
%  - Top:25mm, Right:25mm, Bottom:30mm, Left:25mm                                                  |
%---------------------------------------------------------------------------------------------------

%-------------------
% Vertical Setting |
%-------------------

\setlength{\textheight}{\paperheight}
\addtolength{\topmargin}{-0.4truemm}        % 1inch(25.4mm) - 0.4mm = 25mm
\addtolength{\topmargin}{-\headheight}
\addtolength{\topmargin}{-\headsep}
\addtolength{\textheight}{-55truemm}        % textheight - 55(Top+Bottom)

%---------------------
% Horizontal Setting |
%---------------------

\setlength{\textwidth}{\paperwidth}
\addtolength{\oddsidemargin}{-0.4truemm}    % 1inch(25.4mm) - 0.4mm = 25mm
\addtolength{\evensidemargin}{-0.4truemm}   % 1inch(25.4mm) - 0.4mm = 25mm
\addtolength{\textwidth}{-50truemm}         % textwidth - 50(Right+Left)

%---------------------------------------------------------------------------------------------------
% Figure, Table, Equation, Listings                                                                |
%---------------------------------------------------------------------------------------------------

\makeatletter
  % Add chapter num. to figure num.
  \renewcommand{\thefigure}{\thesection.\arabic{figure}}
  \@addtoreset{figure}{section}
  
  % Add chapter num. to table num.
  \renewcommand{\thetable}{\thesection.\arabic{table}}
  \@addtoreset{table}{section}
  
  % Add chapter num. to equation num.
  \renewcommand{\theequation}{\thesection.\arabic{equation}}
  \@addtoreset{equation}{section}

  % Add chapter num. to sourcecode num.
  % NOTE Don't remove \AtBeginDocument
  \AtBeginDocument{
    \renewcommand*{\thelstlisting}{\thesection.\arabic{lstlisting}}
    \@addtoreset{lstlisting}{section}
  }
\makeatother

% Add text like "図", "表" before \ref
% NOTE \eqref is overwrite amsmath's \eqref
\newcommand\figref[1]{図\ref{#1}}
\newcommand\tabref[1]{表\ref{#1}}
\renewcommand\eqref[1]{式(\ref{#1})}
\newcommand\scref[1]{ソースコード(\ref{#1})}

% Change column height
\renewcommand{\arraystretch}{1.175}

% Define \Hline which is bold \hline
\newcommand{\Hline}{\noalign{\hrule height 1.5pt}}

% for tabularx
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{R}{>{\raggedright\arraybackslash}X}
\newcolumntype{L}{>{\raggedleft\arraybackslash}X}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}

%for listings
\lstset{
  basicstyle={\small\ttfamily},
  identifierstyle={\small},
  commentstyle={\smallitshape},
  keywordstyle={\small\bfseries},
  ndkeywordstyle={\small},
  stringstyle={\small\ttfamily},
  numberstyle={\scriptsize},
  columns=[l]{fullflexible},
  frame={tb},                       % フレーム形式
  framesep=1\zw,                    % フレームまでの余白
  tabsize={4},                      % タブサイズ
  breaklines=true,                  % 自動改行
  xrightmargin=0\zw,                % 右余白
  xleftmargin=2\zw,                 % 左余白
  framexleftmargin=1\zw,            % 左フレーム余白
  framexrightmargin=0\zw,           % 右フレーム余白
  lineskip=-0.5ex,                  % 行送り
  belowskip=2\zh,                   % 下余白
  abovecaptionskip=.5\zh,           % キャプションまでの余白
  aboveskip=1.5\zh,                 % 上余白
  numbers=left,                     % 行番号付与
  stepnumber=1,                     % 行番号間隔
  numbersep=1\zw,                   % 行番号と本文の間隔
}
\def\lstlistingname{ソースコード}

%---------------------------------------------------------------------------------------------------
% Others                                                                                           |
%---------------------------------------------------------------------------------------------------

% Header / Footer
\pagestyle{fancy}
\fancyhead[L,C,R]{}
\fancyfoot[L,R]{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}          % head line
\renewcommand{\footrulewidth}{0pt}          % foot line

% Change footnote num.
\renewcommand\thefootnote{\arabic{footnote}}
